{% extends "base/base.html" %}

{% load static %}
{% block stylesheet %}
<link rel="stylesheet" href="{% static 'css/products/product_detail.css' %}">
<!-- <script src='https://kit.fontawesome.com/a076d05399.js'></script> -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

{% endblock stylesheet %}
{% block main_content %}

<div class="main-contents lg:mx-20 sm:mx-8 bg-white-400 text-center font-4xl">

    <div id="product_content" name="{{product.pk}}" class="flex flex-row mx-auto z-0">
        <div id="left" class="w=2/5">
            <div>
                <img id="main_image" src="{{product.main_image.url}}">
            </div>
            <div class="w-full flex flex-rows mt-3">
                {% if product.product_images is not None %}
                {% for image in product.product_images.all %}

                <img id="images" class="mr-3" src="{{image.image.url}}">

                {% endfor %}
                {% endif %}
            </div>
            <div class="ml-7 mt-10 text-left" id="farm_news_letter">
                농가 소식
            </div>
            <div id="farm_news" class="relative mt-1 py-2 pl-8">
                <img class="absolute -top-6 -left-2" src="{% static 'images/product_detail/bell.svg' %}">
                {{farmer.farm_news}}
            </div>
        </div>
        <div id="right" class="w-3/5 pr-10 pl-12">
            <div id="top_section" class="flex flex-row">
                <div id="title_section" class="w-5/6">
                    <div id="title">
                        {{product.title}}
                    </div>
                    <div id="subtitle">
                        {{product.sub_title}}
                    </div>
                </div>
                <div id="share" class="w-1/6">
                    <div>
                        <img src="{% static 'images/product_detail/share.svg' %}">
                    </div>
                    <div id="url_copy">
                        URL 복사
                    </div>
                </div>
            </div>
            <div id="cost" class="pt-8 pb-6 mb-2">
                {{product.sell_price}}원
            </div>

            <div id="farmer_section" class="flex flex-row items-center mt-3">
                <div id="farmer_image">
                    <img src="{{farmer.user.profile_image.url}}" id="farmer_img" alt="농장주사진">
                </div>
                <div id="farm_name" class="ml-4 pt-1">
                    {{farmer.farm_name}}
                </div>
                <div id="farmer_name" class="ml-2">
                    {{farmer.user.nickname}}
                </div>
                <a href="{% url 'farmers:farmer_detail' farmer.pk %}">
                    <div id="visit" class="ml-4">
                        방문하기
                    </div>
                </a>
                <div id="sub" name="{{farmer.pk}}" class="ml-2">
                    구독하기
                </div>
            </div>
            <div id="info_section" class="border-b mt-12 pt-5 pb-5">
                <div class="flex flex-rows">
                    <div id="info_t" class="w-1/5 text-left mb-3">배송비</div>
                    <div id="info_c" class="w-4/5 text-left text-red-500">무료</div>
                </div>
                <div class="flex flex-rows mb-3">
                    <div id="info_t" class="w-1/5 text-left">중량/용량</div>
                    <div id="info_c" class="w-4/5 text-left">{{product.weight}}kg</div>
                </div>
                <div class="flex flex-rows mb-3">
                    <div id="info_t" class="w-1/5 text-left">원산지</div>
                    <div id="info_c" class="w-4/5 text-left">국산</div>
                </div>
                <div class="flex flex-rows mb-3">
                    <div id="info_t" class="w-1/5 text-left">안내사항</div>
                    <div id="info_c" class="w-4/5 text-left">{{product.instruction}}</div>
                </div>
            </div>
            <div id="purchase_number_section" class="flex flex-row items-center py-10 mb-5 border-b">
                <div id="quantity_letter" class="mr-12">구매수량</div>
                <div id="quantity_num_section" class="flex flex-row items-center">
                    <div id="minus_btn">-</div>
                    <div id="quantity_number" class="">1</div>
                    <div id="plus_btn">+</div>
                </div>
            </div>
            <div class="flex flex-rows justify-end items-end mt-10 mb-7 pt-10">
                <div id="total_price_letter" class="mb-4 mr-10">총 상품 금액 :</div>
                <div id="total_price">{{product.sell_price}}</div>
                <div id="won" class="mb-2 ml-2">원</div>
            </div>
            <div id="buttons" class="flex flex-rows">
                <div id="wish">찜하기</div>

                <div id="cart" class="mr-12 ml-3">장바구니 담기</div>
                <div id="purchase">바로 구매하기</div>
            </div>
        </div>
    </div>

    <div id="product_desc" class="flex flex-rows justify-start w-5/6 my-10 mx-auto w-3/5">
        <a href="#product_desc" class="w-1/6">
            <div id="sel" class="py-3 border-t border-r border-l">상품설명</div>
        </a>
        <a href="#product_info" class="w-1/6">
            <div id="n_sel" class="py-3 border-b border-t border-r">상세정보</div>
        </a>
        <a href="#product_review" class="w-1/6">
            <div id="n_sel" class="py-3 border-b border-t border-r">리뷰 ({{comments.count}})</div>
        </a>
        <a href="#product_qna" class="w-1/6">
            <div id="n_sel" class="py-3 border-b border-t border-r">상품문의 ({{questions.count}})</div>
        </a>
        <div class="w-2/6 border-b"></div>
    </div>
    <div id="desc_img_box">
        <img id="logo" class="mx-auto" src="{% static 'images/mainlogo_small.svg' %}">
        <img id="desc_img" class="mx-auto" src="{{product.desc_image.url}}" alt="상품설명">
        <img id="desc_img" class="mx-auto" src="{{product.desc_image2.url}}" alt="상품설명">
    </div>

    <!-- 상세정보 -->
    <div id="product_info" class="flex flex-rows justify-start w-5/6 my-10 mx-auto w-3/5">
        <a href="#product_desc" class="w-1/6">
            <div id="n_sel" class="py-3 border-t border-r border-l border-b">상품설명</div>
        </a>
        <a href="#product_info" class="w-1/6">
            <div id="sel" class="py-3 border-t border-r">상세정보</div>
        </a>
        <a href="#product_review" class="w-1/6">
            <div id="n_sel" class="py-3 border-b border-t border-r">리뷰 ({{comments.count}})</div>
        </a>
        <a href="#product_qna" class="w-1/6">
            <div id="n_sel" class="py-3 border-b border-t border-r">상품문의 ({{questions.count}})</div>
        </a>
        <div class="w-2/6 border-b"></div>
    </div>
    <div id="info_detail" class="grid grid-cols-4 mx-auto">
        <div>포장단위별 용량(중량), 수량, 크기</div>
        <div>{{product.weight}}kg</div>
        <div>관련법상 표기사항</div>
        <div>해당 사항 없음</div>
        <div>농수산물 원산지 표시에 관한 법률에 따른 원산지</div>
        <div>국산</div>
        <div>상품구성</div>
        <div>{{product.category.name}}</div>
        <div>제조연월일, 유통기한 또는 품질유지기한</div>
        <div>제품 별도 표기</div>
        <div>소비자상담</div>
        <div>홈페이지 고객문의센터</div>
    </div>
    <div id="product_review" class="flex flex-rows justify-start w-5/6 my-10 mx-auto w-3/5">
        <a href="#product_desc" class="w-1/6">
            <div id="n_sel" class="py-3 border-t border-r border-l border-b">상품설명</div>
        </a>
        <a href="#product_info" class="w-1/6">
            <div id="n_sel" class="py-3 border-b border-t border-r">상세정보</div>
        </a>
        <a href="#product_review" class="w-1/6">
            <div id="sel" class="py-3 border-t border-r">리뷰 ({{comments.count}})</div>
        </a>
        <a href="#product_qna" class="w-1/6">
            <div id="n_sel" class="py-3 border-b border-t border-r">상품문의 ({{questions.count}})</div>
        </a>
        <div class="w-2/6 border-b"></div>
    </div>
</div>

<!-- 리뷰 -->
<div id="review" class='flex justify-center w-full'>
    <div class='flex flex-col my-16 mx-auto w-5/6' id='review_score'>
        <h2 class="text-center mb-5 text-xl" style="color: #4d4d4d;">구매 만족도</h2>
        <div id="total_stars" class="mx-auto">
            <div id="total_stars" class='flex flex-row justify-center'>
                {% for i in total_score %}
                <img class='mr-3' src="{% static 'images/product_detail/big_yellow_star.svg' %}" alt="big_yellow_star">
                {% endfor %}
                {% for i in remainder_score %}
                <img class='mr-3' src="{% static 'images/product_detail/big_star.svg' %}" alt="star">
                {% endfor %}
            </div>
            <p class="mt-3 text-center mb-16" id="percent">{{ total_percent }}% 만족</p>
        </div>
        <div class='flex flex-row justify-between mx-auto' style="width: 990px;">
            <div id="fresh" style="width: 266px;">
                <p class="mb-5 text-center" id='score_title'>신선도</p>
                <div class="flex flex-row items-center">
                    <div class="text-right mr-4" style="width: 60px;">신선해요</div>
                    <div id="score_range_wrap">
                        <div class="" id="score_range" style="width: {{freshness_5}}%;">
                            <div id="end_point"></div>
                        </div>
                    </div>
                </div>
                <div class="flex flex-row items-center">
                    <div class="text-right mr-4" style="width: 60px;">보통이에요</div>
                    <div id="score_range_wrap">
                        <div class="" id="score_range" style="width: {{freshness_3}}%;">
                            <div id="end_point"></div>
                        </div>
                    </div>
                </div>
                <div class="flex flex-row items-center">
                    <div class="text-right mr-4" style="width: 60px;">아쉬워요</div>
                    <div id="score_range_wrap">
                        <div class="" id="score_range" style="width: {{freshness_1}}%;">
                            <div id="end_point"></div>
                        </div>
                    </div>
                </div>
            </div>
            <div id="taste" style="width: 266px;">
                <p class="mb-5 text-center" id='score_title'>맛</p>
                <div class="flex flex-row items-center">
                    <div class="text-right mr-4" style="width: 60px;">맛있어요</div>
                    <div id="score_range_wrap">
                        <div class="" id="score_range" style="width: {{flavor_5}}%;">
                            <div id="end_point"></div>
                        </div>
                    </div>
                </div>
                <div class="flex flex-row items-center">
                    <div class="text-right mr-4" style="width: 60px;">보통이에요</div>
                    <div id="score_range_wrap">
                        <div class="" id="score_range" style="width: {{flavor_3}}%;">
                            <div id="end_point"></div>
                        </div>
                    </div>
                </div>
                <div class="flex flex-row items-center">
                    <div class="text-right mr-4" style="width: 60px;">아쉬워요</div>
                    <div id="score_range_wrap">
                        <div class="" id="score_range" style="width: {{flavor_1}}%;">
                            <div id="end_point"></div>
                        </div>
                    </div>
                </div>
            </div>
            <div id="price" style="width: 266px;">
                <p class="mb-5 text-center" id='score_title'>가성비</p>
                <div class="flex flex-row items-center">
                    <div class="text-right mr-4" style="width: 60px;">좋아요</div>
                    <div id="score_range_wrap">
                        <div class="" id="score_range" style="width: {{cost_5}}%;">
                            <div id="end_point"></div>
                        </div>
                    </div>
                </div>
                <div class="flex flex-row items-center">
                    <div class="text-right mr-4" style="width: 60px;">보통이에요</div>
                    <div id="score_range_wrap">
                        <div class="" id="score_range" style="width: {{cost_3}}%;">
                            <div id="end_point"></div>
                        </div>
                    </div>
                </div>
                <div class="flex flex-row items-center">
                    <div class="text-right mr-4" style="width: 60px;">아쉬워요</div>
                    <div id="score_range_wrap">
                        <div class="" id="score_range" style="width: {{cost_1}}%;">
                            <div id="end_point"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div id="comment_list" class="flex flex-col mx-auto z-0">
    {% if comments.exists is False %}
    <div class='text-center h-28'> 아직 작성된 리뷰가 없습니다. </div>
    {% else %}
    {% for comment in comments %}
    <div class='mb-16'>
        <div class="flex flex-row mb-9" id="comment">
            <div class="">
                <img id="reviewer_img" src="{{comment.consumer.user.profile_image.url}}" alt="">
            </div>
            <div class="flex flex-col ml-6 border-b-2" style="width: 880px; font-size: 15px;">
                <div class="flex flex-row mb-3">
                    <div class="text-left" style="width: 175px; border-right: solid 3px #999999;">
                        {{ comment.consumer.user.nickname }}</div>
                    <div class="text-center" style="width: 340px; border-right: solid 3px #999999; color:#989898;">
                        {{ comment.create_at|date:"Y. m. d h:i" }}</div>
                    <div class="flex flex-row" id="report" style="margin-left:87.8px">
                        <img src="{% static 'images/report.svg' %}" alt="">
                        <div class="text-black text-opacity-40 pl-2">신고하기</div>
                    </div>
                </div>
                <div class="flex flex-row pb-5 items-center">
                    <div class="text-black text-opacity-40 mr-16">{{ product.title }} 구매</div>
                    <div id="stars" class='flex flex-row items-center'>
                        {% for i in comment.avg|rjust:comment.avg %}
                        <img class='mr-3 h-6 w-6' src="{% static 'images/product_detail/yellow_star.svg' %}"
                            alt="yellow_star">
                        {% endfor %}
                        {% for i in 5|rjust:4 %}
                        <img class='mr-3 h-6 w-6' src="{% static 'images/product_detail/star.svg' %}" alt="yellow_star">
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
        <div class="mb-12" id="score_table_wrap">
            <table id="score_table">
                <tr>
                    <td class="py-2 text-center"> 신선도 </td>
                    <td class="py-2 text-center"> 맛 </td>
                    <td class="py-2 text-center"> 가성비 </td>
                </tr>
                <tr>
                    <td class="py-4">
                        {% if comment.freshness == 1 %}
                        <img src="{% static 'images/product_detail/score_1.svg' %}" class="mx-auto" alt="">
                        {% elif comment.freshness == 3 %}
                        <img src="{% static 'images/product_detail/score_3.svg' %}" class="mx-auto" alt="">
                        {% else %}
                        <img src="{% static 'images/product_detail/score_5.svg' %}" class="mx-auto" alt="">
                        {% endif %}
                    </td>
                    <td class="py-4">
                        {% if comment.flavor == 1 %}
                        <img src="{% static 'images/product_detail/score_1.svg' %}" class="mx-auto" alt="">
                        {% elif comment.flavor == 3 %}
                        <img src="{% static 'images/product_detail/score_3.svg' %}" class="mx-auto" alt="">
                        {% else %}
                        <img src="{% static 'images/product_detail/score_5.svg' %}" class="mx-auto" alt="">
                        {% endif %}
                    </td>
                    <td class="py-4">
                        {% if comment.cost_performance == 1 %}
                        <img src="{% static 'images/product_detail/score_1.svg' %}" class="mx-auto" alt="">
                        {% elif comment.cost_performance == 3 %}
                        <img src="{% static 'images/product_detail/score_3.svg' %}" class="mx-auto" alt="">
                        {% else %}
                        <img src="{% static 'images/product_detail/score_5.svg' %}" class="mx-auto" alt="">
                        {% endif %}
                    </td>
                </tr>
            </table>
        </div>
        <div id="review_txt" class="text-left">{{ comment.text }}</div>
        <div id="review_imgs" class="flex flex-row text-left mt-5">
            {% for img in comment.product_comment_images.all %}
            <div id="review_img" class="mb-9"><img src="{{img.image.url}}" alt="사진없음"
                    style="width:241px; height:241px; object-fit: cover;"></div>
            {% endfor %}
        </div>
        <div id="review_comment">
            <div class="flex flex-row justify-center mb-4">
                <button id="more_btn" class="rec_more" style="outline: none;">
                    댓글보기 &nbsp; <i id="show_icon" class='fas fa-caret-down'></i> <i class="fas fa-caret-up"
                        style="display: none;"></i>
                </button>
            </div>
            <div class="recomments hide">
                <div class='flex flex-col recomment_form' id='recomment_form_{{ comment.id }}' name='{{comment.id}}'>
                    {% for recomment in comment.product_recomments.all %}
                    <div class="recomment_list text-center m-4 p-4" id="recomment_list_{{ comment.id }}">
                        <div class="flex flex-row" id="recomment">
                            <div class="mr-4" style="width: 10px; height: 10px; 
                                                    border-left: 2px solid #5c6754; 
                                                    border-bottom: 2px solid #5c6754;"></div>
                            <div class="">
                                <img id="consumer_img" src="{{ recomment.author.profile_image.url }}" alt="">
                            </div>
                            <div class="flex items-center ml-6">
                                <div class="flex flex-row" style="font-size: 15px;">
                                    <div class="text-left" style="width: 175px; border-right: solid 3px #999999;">
                                        {{ recomment.author.nickname }}</div>
                                    <div class="" style="width: 340px; border-right: solid 3px #999999; color:#989898;">
                                        {{ recomment.create_at|date:"Y. m. d h:i" }}</div>
                                    <div class="flex flex-row" id="report" style="margin-left:87.8px">
                                        <img src="{% static 'images/report.svg' %}" alt="">
                                        <div class="text-black text-opacity-40 pl-2">신고하기</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="mt-6 mb-6 text-left pl-8" style="font-size: 17px;">
                            {{ recomment.text }}
                        </div>
                    </div>
                    {% endfor %}
                </div>
                <div class="flex flex-row mt-4 justify-between" id="recommentform_{{comment.pk}}">
                    {% csrf_token %}
                    {{ recomment_form.text }}
                    <button id="rec_submit" name="{{comment.id}}">댓글작성</button>
                </div>
            </div>
        </div>
    </div>
    {% endfor %}
    {% endif %}
</div>

<!-- 상품문의 -->
<div class="main-contents lg:mx-20 sm:mx-8 bg-white-400 text-center font-4xl">

    <div id="product_qna" class="flex flex-rows justify-start w-5/6 my-10 mx-auto w-3/5">
        <a href="#product_desc" class="w-1/6">
            <div id="n_sel" class="py-3 border-t border-r border-l border-b">상품설명</div>
        </a>
        <a href="#product_info" class="w-1/6">
            <div id="n_sel" class="py-3 border-b border-t border-r">상세정보</div>
        </a>
        <a href="#product_review" class="w-1/6">
            <div id="n_sel" class="py-3 border-b border-t border-r">리뷰 ({{comments.count}})</div>
        </a>
        <a href="#product_qna" class="w-1/6">
            <div id="sel" class="py-3 border-t border-r">상품문의 ({{questions.count}})</div>
        </a>
        <div class="w-2/6 border-b"></div>
    </div>

    <div id="question_content" class="mx-auto">
        <div class="flex flex-rows mb-3">
            <div id="q_title">Q & A</div>
            <div id="q_count" class="ml-5 pt-3">(총 {{questions.count}}건)</div>
        </div>
        <div class="flex flex-rows mb-2">
            <img src="{%static 'images/product_detail/index_leaf.svg' %}">
            <div id="q_desc" class="ml-3">구매하시려는 무난이에 대해 궁금한 점들을 문의해주세요</div>
        </div>
        <div class="flex flex-rows mb-10">
            <img src="{%static 'images/product_detail/index_leaf.svg' %}">
            <div id="q_desc" class="ml-3">개인적인 배송관련, 주문 관련 사항들은 1:1 고객상담센터로 문의해주세요</div>
        </div>
        <div id="q_table_top" class="flex flex-rows py-1">
            <div id="q_letter_gray" class="w-2/12">답변상태</div>
            <div id="q_letter_gray" class="w-6/12">제목</div>
            <div id="q_letter_gray" class="w-2/12">작성자</div>
            <div id="q_letter_gray" class="w-2/12">작성일</div>
        </div>
        <div id="qnas-section">
            {% if questions.exists is False %}
            <div class="text-center">아직 무난이에 대해 등록된 질문이 없습니다!</div>
            {% else %}
            {% for q in questions %}
            <a href="{% url 'products:question_read' q.pk %}">
                <div id="q_table_bottom" class="flex flex-rows py-1">
                    {% if q.status is True %}
                    <div id="q_letter_answered" class="w-2/12">답변완료</div>
                    {% else %}
                    <div id="q_letter_gray" class="w-2/12">답변대기</div>
                    {% endif %}
                    <div id="q_letter_black" class="w-6/12">{{q.title}}</div>
                    <div id="q_letter_black" class="w-2/12">{{q.consumer.user.nickname}}</div>
                    <div id="q_letter_gray" class="w-2/12">{{q.create_at.date}}</div>
                </div>
            </a>
            {% endfor %}
            {% endif %}
        </div>
        <div class="flex flex-row justify-end">
            <div id="q_write" class="flex flex-rows justify-center mt-10 w-2/12">
                <a href="/product/question/create?product={{product.pk}}">
                    <div>글쓰기</div>
                </a>
                <img src="{% static 'images/product_detail/pen.svg' %}">
            </div>
        </div>
        <div id="paginator" class="flex flex-row mt-10 justify-center">
            <div class="mr-10">
                << /div>
                    {% for p in question_total_pages %}
                    <div id="qna_paginator" class="mr-10" name="{{p}}">{{p}}</div>
                    {% endfor %}
                    <div>></div>
            </div>
        </div>
    </div>


    <script>
        let plusBtn = document.getElementById('plus_btn')
        let minusBtn = document.getElementById('minus_btn')
        let totalPrice = document.getElementById('total_price')
        let quantityNum = document.getElementById('quantity_number')
        console.log(quantityNum)

        let pricePerOne = parseInt(totalPrice.innerHTML)

        console.log(pricePerOne)
        console.log(plusBtn)
        console.log(minusBtn)
        console.log(totalPrice)

        function addCalTotalPrice(price, quantity) {
            let nowTotalPrice = totalPrice.innerHTML
            nowTotalPrice = parseInt(nowTotalPrice)

            let newTotalOrderPrice = nowTotalPrice + price * quantity
            totalPrice.innerHTML = String(newTotalOrderPrice)
        }

        function subCalTotalPrice(price, quantity) {
            let nowTotalPrice = totalPrice.innerHTML
            nowTotalPrice = parseInt(nowTotalPrice)

            let newTotalOrderPrice = nowTotalPrice - price * quantity
            if (newTotalOrderPrice < 0)
                newTotalOrderPrice = 0
            totalPrice.innerHTML = String(newTotalOrderPrice)
        }

        plusBtn.addEventListener('click', function () {
            let num = parseInt(quantityNum.innerHTML)
            num += 1
            quantityNum.innerHTML = num
            addCalTotalPrice(pricePerOne, 1)
        })

        minusBtn.addEventListener('click', function () {
            let num = parseInt(quantityNum.innerHTML)
            if (num <= 1)
                num = 1
            else {
                num -= 1
                quantityNum.innerHTML = num
                subCalTotalPrice(pricePerOne, 1)
            }

        })

        //상품 사진 조정 
        let main_image = document.getElementById('main_image')
        let sub_images = document.querySelectorAll('#images')

        sub_images.forEach(item=>{
            item.addEventListener('click', function(){
                let tmp_url = main_image.getAttribute('src')
                main_image.setAttribute('src', item.getAttribute('src'))
                item.setAttribute('src', tmp_url)
            })
        })

        let wishBtn = document.getElementById('wish')
        let product_pk = document.getElementById('product_content').getAttribute('name')

        wishBtn.addEventListener('click', function () {

            data = {
                'pk': product_pk,
                "csrfmiddlewaretoken": "{{csrf_token}}",
            }
            $.ajax({
                type: 'POST',
                url: "{% url 'users:wish' %}",
                dataType: 'json',
                data: data,
                success: function (response) {
                    if (response.status == 0) {
                        alert('이미 찜한 무난이 입니다!')
                    }
                    else if (response.status == 1) {
                        alert('무난이를 찜했습니다')
                    }
                },
                error: function (request, status, error) {
                    alert('로그인이 필요합니다.')
                }
            })
        })

        const subBtn = document.getElementById('sub')
        console.log(subBtn)
        subBtn.addEventListener('click', function () {
            let farmerPk = subBtn.getAttribute('name')
            console.log(farmerPk)
            data = {
                'farmer_pk': farmerPk,
                "csrfmiddlewaretoken": "{{csrf_token}}",
            }
            $.ajax({
                type: 'POST',
                url: "{% url 'users:subs' %}",
                dataType: 'json',
                data: data,
                success: function (response) {
                    if (response.status == -1)
                        alert("구독하지 못했습니다. 다시 시도해주세요")
                    else if (response.status == 0)
                        alert("이미 구독한 농가입니다!")
                    else
                        alert("농가를 구독하였습니다!")
                },
                error: function (request, status, error) {
                    alert('로그인이 필요합니다.')
                }
            
            })

                        else if (response.success == 0)
            

            // $.ajax({
            //         type: 'POST',
            //         url: "{% url 'users:cartInAjax' %}",
            //         dataType: 'json',
            //         data: data,
            //         success: function (response) {
            //             alert(response.message)
            //         },
            //         error: function (request, status, error) {
            //             alert('로그인이 필요합니다.')
            //         }
            //     })



        // 댓글 작성 버튼 toggle
        let recomments = document.querySelectorAll('.recomments')
        recomments.forEach(recomment => recomment.classList.add("hide"))
        $(document).on('click', '#more_btn', function () {
            $(this).parent().siblings('.recomments').toggle();
            $(this).children('.fa-caret-down').toggle();
            $(this).children('.fa-caret-up').toggle();
            const [...recomment_forms] = document.querySelectorAll('.recomment_form')
            recomment_forms.forEach((form) => {
                form.scrollBy(0, 10000)
            });

            // 스크롤 하단 고정 (수정 필요)


            // 리뷰 댓글 작성
            const btns = document.querySelectorAll('#rec_submit')
            btns.forEach(btn => btn.addEventListener('click', recommentSubmit));
            function recommentSubmit() {
                let comment_id = $(this).attr('name') // {{comment.id}}
                let parent = $(this).parent(); // recommentform_{{comment.id}}
                let text = parent.children('#id_text').val() // recomment text value
                console.log(text);

                $.ajax({
                    type: 'POST',
                    url: `/comment/${comment_id}/recomment/create/`,
                    dataType: 'json',
                    data: {
                        'text': text,
                        'pk': comment_id,
                        'user': '{{ request.user.pk }}',
                        'csrfmiddlewaretoken': '{{ csrf_token }}',
                    },
                    success: function (data) {
                        if (text === '') {
                            alert('댓글을 입력해주세요');
                            return;
                        }
                        let recomment = `
                <div class="recomment_list text-center m-4 p-4" id="recomment_list_${comment_id}">
                    <div class="flex flex-row" id="recomment">
                        <div class="mr-4" style="width: 10px; height: 10px; 
                                            border-left: 2px solid #5c6754; 
                                            border-bottom: 2px solid #5c6754;"></div>
                        <div class="">
                            <img id="consumer_img" src="${data.user_image}" alt="">
                        </div>
                        <div class="flex items-center ml-6">
                            <div class="flex flex-row" style="font-size: 15px;">
                                <div class="text-left" style="width: 175px; border-right: solid 3px #999999;">${data.author}</div>
                                <div class="" style="width: 340px; border-right: solid 3px #999999; color:#989898;">${data.create_at}</div>
                                <div class="flex flex-row" id="report" style="margin-left:87.8px">
                                    <img src="{% static 'images/report.svg' %}" alt="">
                                    <div class="text-black text-opacity-40 pl-2">신고하기</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="mt-6 mb-6 text-left pl-8" style="font-size: 17px;">
                        ${data.text}
                    </div>
                </div>`
                        let list = parent.parent().children(`div[name=${comment_id}]`);
                        list.append(recomment);
                        parent.children('#id_text').val('')
                        const [...recomment_forms] = document.querySelectorAll('.recomment_form')
                        recomment_forms.forEach((form) => {
                            form.scrollBy(0, 10000)
                        });
                    },
                    error: function () {
                        alert('error');
                    }
                });
            }

        let qna_page = document.querySelectorAll('#qna_paginator')
        qna_page.forEach(item => {
            item.addEventListener('click', function () {
                let page_num = item.getAttribute('name')

                $.ajax({
                    type: 'POST',
                    url: "{% url 'products:qna_paginator' %}",
                    dataType: 'json',
                    data: {
                        'product_pk': product_pk,
                        'page_num': page_num,
                        "csrfmiddlewaretoken": "{{csrf_token}}",
                    },
                    success: function (data) {
                        let qnaSection = document.getElementById('qnas-section')
                        console.log(data)
                        qnaSection.innerHTML = ''
                        data.questions.forEach(item => {
                            let status = item.status
                            let title = item.title
                            let consumer = item.consumer
                            let create_at = item.create_at
                            let q_pk = item.pk
                            console.log(status + ' ' + title + ' ' + consumer + ' ' + create_at)
                            let qnaLine = `<a href='/product/question/${q_pk}'> <div id="q_table_bottom" class="flex flex-rows py-1">`;

                            if (status == true) {
                                qnaLine += `
                            <div id="q_letter_answered" class="w-2/12">답변완료</div>
                    <div id="q_letter_black" class="w-6/12">${title}</div>
                    <div id="q_letter_black" class="w-2/12">${consumer}</div>
                    <div id="q_letter_gray" class="w-2/12">${create_at.date}</div>
                </div>
                </a>`
                                }
                                else {
                                    qnaLine += `
                            <div id="q_letter_answered" class="w-2/12">답변대기</div>
                    <div id="q_letter_black" class="w-6/12">${title}</div>
                    <div id="q_letter_black" class="w-2/12">${consumer}</div>
                    <div id="q_letter_gray" class="w-2/12">${create_at.date}</div>
                </div>
                </a>`
                                }
                                qnaSection.insertAdjacentHTML('beforeend', qnaLine)
                            })
                        },
                        error: function () {
                            alert("error")
                        }

                    })
                })
            })
        })
   


    </script>
    <script>
        // product review image slider
        let review_imgs = document.querySelectorAll('#review_imgs');
        review_imgs.forEach(img => img.classList.add('review_img_slick'))

        $('.review_img_slick').slick({
            infinite: false,
            slidesToShow: 3,
            slidesToScroll: 3
        });
    </script>

    {% endblock main_content %}