{% extends 'base/base.html' %}
{% load static %}

{% block stylesheet %}
    <link rel="stylesheet" href="{% static 'css/users/farm_enroll.css' %}">
    <link rel="stylesheet" href="{% static 'css/users/farmers_detail.css' %}">
{% endblock %}

{% block title_name %}
입점 등록
{% endblock title_name %}

{% block main_content %}
<script>

</script>
<div class="main-contents flex justify-center lg:mx-20 sm:mx-8 bg-white-400 text-center font-4xl">
    <div id='signup_form' class="mt-10 flex flex-col">
        <div class="mx-auto font-bold text-3xl mt-6" style="color: #5c6754; margin-bottom: 63px;">입점 등록</div>
        <div class="flex flex-row justify-around" id="sub_title">
            <div> 정보 입력 </div>
            <div> 계약서 작성 </div>
        </div>
        <div class="relative mx-auto mt-2" id="border">
            <div class="absolute" id="step" style="width:66%"></div>
        </div>
        <form method="POST" action="{% url 'farmers:farm_enroll' step='step_1' %}" onkeydown="return event.key != 'Enter';">
            {% csrf_token %}
            <div class="font-medium text-3xl text-left mb-16" style="margin-left:60.5px">농장 정보 입력</div>
            <!--농장 이름-->
            <div class="input_forms grid">
                {{farm_form.farm_name.label_tag}}
                {{farm_form.farm_name}}
            </div>
            <!--프로필 사진 & 농장 사진-->
            <div class="flex flex-row mb-11">
                <div class='flex flex-col'>
                    <div id="img_label">{{farm_form.farmer_profile.label_tag}}</div>
                    <div class="" id="img_desc">농부님의 사진을 올려주세요</div>
                </div>
                <div>
                    <div class="filebox">
                        <div class="default_img_1" 
                        style="background-image: url('{% static 'images/farm/farmer_default.svg' %}');"></div>
                        <label for="id_farmer_profile">업로드</label> 
                        {{farm_form.farmer_profile}}
                    </div>
                </div>
                <div class='flex flex-col'>
                    <div id="img_label">{{farm_form.farm_profile.label_tag}}</div>
                    <div class="" id="img_desc">농장로고나 대표사진을 <br>올려주세요</div>
                </div>
                <div>
                    <div class="filebox">
                        <div class="default_img_2" 
                        style="background-image: url('{% static 'images/farm/farm_default.svg' %}');"></div>
                        <label for="id_farm_profile">업로드</label> 
                        {{farm_form.farm_profile}}
                    </div>
                </div>
            </div>
            <!--농장 소개-->
            <div class="input_forms grid">
                {{farm_form.profile_title.label_tag}}
                {{farm_form.profile_title}}
                {{farm_form.profile_desc.label_tag}}
                {{farm_form.profile_desc}}
            </div>
            <!--해시 태그-->
            <div class="flex flex-row">
                <div class="mr-6" id="cat_label">{{farm_form.farm_cat.label_tag}}</div>
                {{farm_form.farm_cat}}
            </div>
            <div class="grid grid-flow-row grid-rows-1 grid-cols-4 gap-4 mt-4" id="hashtag_wrap">
                <input type="text" placeholder="# 직접입력" onKeyDown="onKeyDown()"; id="new_tag"/>
            </div>
            <div class="line mx-auto mb-14" style="margin-top: 35px;"></div>
            <div class="font-medium text-3xl text-left mb-16" style="margin-left:60.5px; color:#4d4d4d;">Farmer's Page Sample</div>
            <div class="p-4" id="sample_wrap">
                {% include 'users/farmer_detail_sample.html' %}
            </div>
            <button class="submit" onclick="location.href='{% url 'farmers:farm_enroll' step='step_3' %}'">다음 단계로</button>
        </form>
    </div>
</div> 

<script>
    //프로필 사진
    function readInputFile_1(input) {
        if($("#id_farmer_profile")) {
            var reader = new FileReader();
            reader.onload = function (e) {
                var path = e.target.result;
                path = "url(" + path + ")";
                $('.default_img_1').css(
                    {
                        'background':path, 
                        'background-size':'cover', 
                        'background-position':'center'
                    }
                );
            }
            reader.readAsDataURL(input.files[0]);
        }
    }
    $("#id_farmer_profile").on('change', function(){
        readInputFile_1(this);
    });
    //농장 사진
    function readInputFile_2(input) {
        if($("#id_farm_profile")) {
            var reader = new FileReader();
            reader.onload = function (e) {
                var path = e.target.result;
                path = "url(" + path + ")";
                $('.default_img_2').css(
                    {
                        'background':path, 
                        'background-size':'cover', 
                        'background-position':'center'
                    }
                );
            }
            reader.readAsDataURL(input.files[0]);
        }
    }
    $("#id_farm_profile").on('change', function(){
        readInputFile_2(this);
    });

    // hash tag create
    function onKeyDown() {
        if(event.keyCode === 13) {
            var input = document.createElement("input");
            input.setAttribute('type', 'text');
            input.setAttribute('onKeyDown', 'onKeyDown()')
            input.setAttribute('id', 'new_tag')
            var parent = document.getElementById('hashtag_wrap');
            parent.appendChild(input);
        }
    }

    function resizeInput() {
        this.style.width = this.value.length + "ch";
    }
    var hashtag_input = document.getElementById('new_tag'); // get the input element
    hashtag_input.addEventListener('input', resizeInput); // bind the "resizeInput" callback on "input" event
    resizeInput.call(hashtag_input); // immediately call the function
    
    //farmer's page sample
    $('#id_farm_name').keyup(function() {
        $('#sample_farm_name').text($(this).val());
    });
    $('#id_profile_title').keyup(function() {
        $('#sample_profile_title').text($(this).val());
    });
    $('#id_profile_desc').keyup(function() {
        $('#sample_profile_desc').text("&#34;"+ $(this).val() + "&#34;");
    });
</script>
{% endblock %}